from solana.rpc.async_api import AsyncClient
from solana.keypair import Keypair
import json

class SolanaClient:
    def __init__(self):
        self.rpc_url = "https://api.mainnet-beta.solana.com"
        self.rpc = AsyncClient(self.rpc_url)

        # Charger la keypair depuis keypair.json par exemple
        with open("keypair.json", "r") as f:
            secret_key = json.load(f)
        self.keypair = Keypair.from_secret_key(bytes(secret_key))

        # optionnel : clé API Jupiter
        self.jupiter_api_key = "b1ac693e-ee12-4faa-8f04-0049f74ec932"

    def get_keypair(self):
        return self.keypair

    async def calculate_trade_size(self) -> float:
        # exemple ultra simple : 0.05 SOL par trade
        return 0.05

    def get_token_balance(self, token_mint: str) -> float:
        # TODO: ici, il faut implémenter une vraie lecture du solde token
        # Pour le moment, tu peux retourner un montant fixe ou lire via RPC.
        return 1.0

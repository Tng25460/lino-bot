from __future__ import annotations
from typing import Any, Dict, Tuple

from config.settings import MIN_LIQUIDITY_USD, MAX_MARKET_CAP_USD


class RiskChecker:
    """
    Risk checker minimal, stateless.
    Pas de logger requis (évite les erreurs d'init).
    """

    def allow_buy(self, ov: Dict[str, Any]) -> Tuple[bool, str]:
        """
        ov: overview Birdeye normalisé
        """
        data = ov.get("data") or {}

        try:
            liq = float(data.get("liquidity") or 0.0)
        except Exception:
            liq = 0.0

        try:
            mc = float(data.get("marketCap") or 0.0)
        except Exception:
            mc = 0.0

        if liq < MIN_LIQUIDITY_USD:
            return False, f"liquidity trop faible ({liq:.0f} < {MIN_LIQUIDITY_USD:.0f})"

        if mc > 0 and mc > MAX_MARKET_CAP_USD:
            return False, f"marketcap trop élevé ({mc:.0f} > {MAX_MARKET_CAP_USD:.0f})"

        return True, "ok"
